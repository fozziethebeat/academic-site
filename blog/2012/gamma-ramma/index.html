<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  FozzieTheBeat


  | Gamma Ramma

</title>
<meta name="description" content="A simple blog tracking my journey back into Open Source.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://raw.githubusercontent.com/jwarby/pygments-css/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2012/gamma-ramma/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://fozziethebeat.com/">
       FozzieTheBeat
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          

          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Gamma Ramma</h1>
    <p class="post-meta">June 25, 2012</p>
  </header>

  <article class="post-content">
    <h2 id="before-getting-to-cooler-mixture-models">Before getting to Cooler Mixture Models</h2>

<p>Before going into the depths that is ways to improve the simple Multinomial
Mixture Model that I discussed in the last post, I want to give a little
adventure story regarding the <a href="https://en.wikipedia.org/wiki/Gamma_distribution">Gamma
distribution</a>. Why the Gamma
distribution?  Mainly because it is deeply tied to <a href="https://en.wikipedia.org/wiki/Normal_distribution">Gaussian
distributions</a> and those
will factor heavily into cool things you can do in mixture models.</p>

<h3 id="this-thing-called-my-conjugate-prior">This thing called my Conjugate Prior</h3>

<p>So how is the Gamma distribution related to a Gaussian distribution? The short
story is that a properly parameterized Gamma distribution can approximate the
precision (or inverse variance) for a Gaussian distribution (the proper wording
for this relationship is that a Gamma distribution is a <a href="https://en.wikipedia.org/wiki/Conjugate_prior">conjugate
prior</a> for a Gaussian
distribution when you know the mean but don’t know the precision). This turns
out to be super powerful when you have some idea of what the mean of your
Gaussian is but need to estimate the variance. However, this distributions has
some flavors that can really wreck havoc on your ability to learn these values
if you use them in the wrong place, and similarly people are really terrible at
pointing out which flavour you can and should use. So here’s an adventure on
taste testing the Gamma distribution</p>

<h3 id="sampling-from-gamma-distributions">Sampling from Gamma Distributions</h3>

<p>Let’s start with an example. Let’s say we have two one dimensional Gaussian
distributions. Each distribution is defined by two parameters: for the mean, or
center point, and for the variance, or inverse precision. So let’s say our two
distributions have these two parametrizations: and . Here’s a nice density plot
of these two distributions together:</p>

<p><img src="/assets/img/2012/two_univariate_gaussians.png" alt="Two Gaussians" /></p>

<p>Now let’s look at what the Gamma distribution can do if we sample from it with the “proper” parameters (which I’ll point out later on).</p>

<p><img src="/assets/img/2012/gamma_breeze_samples.png" alt="Two Gammas" /></p>

<p>It looks like a good approximation of what we know the two variance values to
be and the samples can be generated really easily with Scala’s
<a href="https://github.com/dlwh/breeze">breeze</a> library
which you’ll see in the next section. But let’s for funsies sake say that we
don’t like using breeze (say because we hate Scala and prefer to trust
libraries written in Java), we may then want to use some other implementation
of this distribution, like say in <a href="https://commons.apache.org/proper/commons-math/">Apache Commons
Math</a> or Java’s <a href="https://dst.lbl.gov/ACSSoftware/colt/">Colt
library</a>.  What happens if we take the
parameters we passed into breeze and passed them to these libraries? What comes
out? Let’s See!</p>

<p><img src="/assets/img/2012/gamma_comparison_samples.png" alt="Comparing two Gammas" /></p>

<p>That looks kinda funky. What’s going on? This exposes the difference between
the two main flavors of this distribution: two related but poorly explained
ways to parameterize the model! Both flavours depend on a shape parameter that
(aptly named) guides the shape of the distribution. The difference in the
flavours is the use of either a scale parameter, sometimes referred to as , or
a rate parameter, sometimes denoted as . Is there a relation between these two?
Totally! They are inverses of each other, i.e. .</p>

<h2 id="finding-the-funky-culprit">Finding the funky culprit</h2>

<p>Now how do we know which of the above three implementations is doing the right
thing? One way is to use the <a href="https://en.wikipedia.org/wiki/Inverse-gamma_distribution">Inverse Gamma
distribution</a>.
Samples from an Inverse Gamma distribution should (roughly) be the reciprocal
of samples from a Gamma distribution with the same parameters. But these
packages don’t really have an implementation of an Inverse Gamma distribution,
so what else can we do to check? Well, Colt looks to be doing two really wierd
things that violate our intuitions about variances: (a) one set of variance
estimates are completely missing and (b) the one that does exist gives negative
variance values, and we know this to be impossible since the variance is
defined to be an average of real values raised to the power of two. And if we
read the Colt javadoc more carefully, we can figure out that they use the rate
and not the scale, but it’s never totally obvious in their documentation. So if
we fix that in our parameterization, we get this agreeable set of plots:</p>

<p><img src="/assets/img/2012/gamma_comparison_fixed_samples.png" alt="Fixed two Gammas" /></p>

<p>That’s much better looking.</p>

<h2 id="finding-the-magic-parameters">Finding the magic parameters</h2>

<p>Now let’s dive deeper and see how I made all these (now fixed) samples:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="k">import</span> <span class="nn">breeze.stats.distributions.Gamma</span>
<span class="k">import</span> <span class="nn">org.apache.commons.math3.distribution.GammaDistribution</span>
<span class="k">import</span> <span class="nn">cern.jet.random.</span><span class="o">{</span><span class="nc">Gamma</span><span class="k">=&gt;</span><span class="nc">CGamma</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="nv">alpha</span> <span class="k">=</span> <span class="mf">1d</span> <span class="o">+</span> <span class="mi">5000</span>
<span class="k">val</span> <span class="nv">beta_1</span> <span class="k">=</span> <span class="mf">1d</span> <span class="o">+</span> <span class="nf">data</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="k">_</span><span class="o">-</span><span class="mf">5.0</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nf">pow</span><span class="o">(</span><span class="k">_</span><span class="o">,</span><span class="mi">2</span><span class="o">)).</span><span class="py">sum</span><span class="o">/</span><span class="mf">2d</span>
<span class="k">val</span> <span class="nv">beta_2</span> <span class="k">=</span> <span class="mf">1d</span> <span class="o">+</span> <span class="nf">data</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="k">_</span><span class="o">-</span><span class="mf">10.0</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nf">pow</span><span class="o">(</span><span class="k">_</span><span class="o">,</span><span class="mi">2</span><span class="o">)).</span><span class="py">sum</span><span class="o">/</span><span class="mf">2d</span>
<span class="k">val</span> <span class="nv">pw</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="nf">args</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">numsamples</span> <span class="k">=</span> <span class="nf">args</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="py">toInt</span>
<span class="nf">for</span> <span class="o">(</span> <span class="o">((</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">),</span> <span class="n">i</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nc">List</span><span class="o">((</span><span class="n">α</span><span class="o">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">β</span><span class="o">\</span><span class="n">_1</span><span class="o">),</span> <span class="o">(</span><span class="n">α</span><span class="o">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">β</span><span class="o">\</span><span class="n">_2</span><span class="o">)).</span><span class="py">zipWithIndex</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create a Gamma distribution using breeze </span>
    <span class="k">val</span> <span class="nv">gdist</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Gamma</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
    <span class="c1">// Create a Gamma distribution using Apache Commons Math</span>
    <span class="k">val</span> <span class="nv">acgDist</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GammaDistribution</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>

    <span class="nf">for</span> <span class="o">(</span><span class="n">x</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">numsamples</span><span class="o">)</span> <span class="o">{</span>
        <span class="nv">pw</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"breeze %d %f"</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">gdist</span><span class="o">.</span><span class="py">sample</span><span class="o">)/</span><span class="mf">10d</span><span class="o">))</span>
        <span class="nv">pw</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"commons-math %d %f"</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">acgDist</span><span class="o">.</span><span class="py">sample</span><span class="o">)/</span><span class="mf">10d</span><span class="o">))</span>
        <span class="c1">// This is the easiet way to sample from Colt's gamma distribution.  Note that </span>
        <span class="c1">// i'm now turning the scale parameter back into the rate parameter.</span>
        <span class="nv">pw</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"colt %d %f"</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">CGamma</span><span class="o">.</span><span class="py">staticNextDouble</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="o">))/</span><span class="mf">10d</span><span class="o">))</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="nv">pw</span><span class="o">.</span><span class="py">close</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>In this snippet, I’ve left out data, but it’s simply a map for accessing the
list of samples I drew earlier to make the Gaussian plot. The key equations
here are for computing what I’m calling <code class="language-plaintext highlighter-rouge">alpha</code> and <code class="language-plaintext highlighter-rouge">beta_*</code>. Looking at a
handy table of <a href="en.wikipedia.org/wiki/Conjugate_prior#Continuous_likelihood_distributions">conjugate priors for continuous likelihood
distributions</a>,
we find these two core equations used in the code:</p>

<p>Where is the number of points in the group and denotes points within coming
from the same distribution. Looking at that table of conjugate priors and the
list created in the first for loop, you might wonder why i use the reciprocal
of the values, i.e. the scales. This is because of the cute footnote in the
conjugate prior table noting that</p>

<p>as computed above is in fact the rate.</p>

<h2 id="an-even-more-terrifying-parametrization">An even more terrifying parametrization</h2>

<p>Now if you thought what I’ve touched on is cool, a little funky, and possible
frustrating in the minor differences, it’s time to really complicate things. A
really smart man by the name of Carl von Rasmussen designed an <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.45.9111">Infinite
Gaussian Mixture
Model</a> that
depends heavily on the Gamma distribution for just
the purpose I’ve described. BUT he gives this parameterization:</p>

<p>Throw this into our sampling code and we get this rediculous plot:</p>

<p><img src="/assets/img/2012/gamma_comparison_samples_ras.png" alt="Infinite Gammas" /></p>

<p>Which is totally wrong. So what gives? Well, at a much later date, Mr.
Rasmussen points out that as he defines them, the two parameters are slightly
mutated versions of the shape and scale as we’ve described them so far. The
real way to use his parameters is to mutate them by doing this:</p>

<h2 id="summary">Summary!</h2>

<p>So to summarize this adventure time blast, I have one key lesson: figure out
which parameterization your software is using and which parameterization a
model designer is using and make sure they match. Otherwise you’ll spend a
terrible amount of time wondering why you just can’t estimate those variances
accurately. I failed to do this a few weeks ago and was quite befuddled for a
while, so don’t be like me.</p>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License"
           style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    This
    work is licensed under a
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      Creative Commons Attribution 4.0 International License
    </a>.

    <br />

    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with the <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
