<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  FozzieTheBeat


  | Finding Events During the Olympics

</title>
<meta name="description" content="A simple blog tracking my journey back into Open Source.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://raw.githubusercontent.com/jwarby/pygments-css/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2012/finding-events-during-the-olympics/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://fozziethebeat.com/">
       FozzieTheBeat
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          

          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Finding Events During the Olympics</h1>
    <p class="post-meta">August 28, 2012</p>
  </header>

  <article class="post-content">
    <p>I needed the event times for every game, tournament, and competition that
happened during the London 2012 Olympics. Thankfully the London 2012 website
posts all this information online. Sadly, this information isn’t posted
anywhere in an easy to utilize format. I was deeply hoping that there would be
a csv file describing when every event took place, but to no avail. Instead,
all I had access to was beautifully rendered web pages like below, which
graphically detail when each event began and end for each day.</p>

<p><img src="/assets/img/2012/olympics-archery-event-example.png" alt="When Archery Events were happening in 2012" /></p>

<p>This handy web page has all the information I need, but how easy is it to get
that information out?</p>

<h2 id="the-raw-event-information">The raw event information</h2>

<p>Well, let’s take a gander at the html used to describe each event:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre> <span class="nt">&lt;li&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"barWrap disciplines"</span><span class="nt">&gt;</span>
     <span class="c">&lt;!--s-u: ARM073900 - ARM073900--&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"left: 72px; width: 90px; height:19px; overflow:hidden;"</span>
          <span class="na">class=</span><span class="s">"bar ed_2012-08-30T12:30:00+01:00"</span>
          <span class="na">id=</span><span class="s">"bar-ARM073900"</span>
          <span class="na">data-type=</span><span class="s">"a_20120830090000 b_"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"barcnt m0"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;a</span>  <span class="na">href=</span><span class="s">"/paralympics/archery/event/men-individual-recurve-w1-w2/phase=arm073900/index.html"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"bar-time"</span><span class="nt">&gt;</span>10:00 <span class="nt">&lt;/span&gt;</span>
           <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"bar-phasedesc"</span><span class="nt">&gt;</span>Ranking Round <span class="nt">&lt;/span&gt;</span>
           <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"bar-scheduleline"</span><span class="nt">&gt;</span>
             <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"score"</span><span class="nt">&gt;&lt;/div&gt;</span>
           <span class="nt">&lt;/div&gt;</span>
         <span class="nt">&lt;/a&gt;</span>
       <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
   <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/li&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>It’s pretty obvious when the event took place no?</p>

<p>Not really. They’ve crammed all the timing information into the second div
element using two different attributes: <code class="language-plaintext highlighter-rouge">class</code> and <code class="language-plaintext highlighter-rouge">data-type</code>. Furthermore,
they’ve also encoded the start time within a deeply nested span. <em>But</em> it gets
<em>better</em>. They use two <em>different</em> time zones and two different date formats,
the <code class="language-plaintext highlighter-rouge">class</code> attribute uses GMT+01:00 using a pretty readible format while the
<code class="language-plaintext highlighter-rouge">data-type</code> uses GMT+00:00 with a horribly mashed together format. But at
least, it’s a regular pattern. So we should be able to get everything we want
by treating this as xml and just extracting the attribute values for the nodes
we care about.</p>

<h2 id="the-obvious-way-to-extract-those-times">The obvious way to extract those times</h2>

<p>XML parsing is both pretty fast and easy, if you select the right language.
Let’s throw this into a simple xml parser and see what happens:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">import</span> <span class="nn">scala.xml.XML</span>

<span class="k">val</span> <span class="nv">eventXml</span> <span class="k">=</span> <span class="nv">XML</span><span class="o">.</span><span class="py">loadFile</span><span class="o">(</span><span class="nf">args</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Parsing…parsing…parsing…</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="n">org</span><span class="o">.</span><span class="na">xml</span><span class="o">.</span><span class="na">sax</span><span class="o">.</span><span class="na">SAXParseException</span><span class="o">;</span> <span class="nl">lineNumber:</span> <span class="mi">3</span><span class="o">;</span> <span class="nl">columnNumber:</span> <span class="mi">299</span><span class="o">;</span> <span class="nc">The</span> <span class="n">entity</span> <span class="n">name</span> <span class="n">must</span> <span class="n">immediately</span> <span class="n">follow</span> <span class="n">the</span> <span class="sc">'&amp;'</span> <span class="n">in</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">reference</span><span class="o">.</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ErrorHandlerWrapper</span><span class="o">.</span><span class="na">createSAXParseException</span><span class="o">(</span><span class="nc">ErrorHandlerWrapper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">198</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ErrorHandlerWrapper</span><span class="o">.</span><span class="na">fatalError</span><span class="o">(</span><span class="nc">ErrorHandlerWrapper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">177</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">XMLErrorReporter</span><span class="o">.</span><span class="na">reportError</span><span class="o">(</span><span class="nc">XMLErrorReporter</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">441</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">XMLErrorReporter</span><span class="o">.</span><span class="na">reportError</span><span class="o">(</span><span class="nc">XMLErrorReporter</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">368</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">XMLScanner</span><span class="o">.</span><span class="na">reportFatalError</span><span class="o">(</span><span class="nc">XMLScanner</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1375</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">sun</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">xerces</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">impl</span><span class="o">.</span><span class="na">XMLScanner</span><span class="o">.</span><span class="na">scanAttributeValue</span><span class="o">(</span><span class="nc">XMLScanner</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">824</span><span class="o">)</span>
    <span class="o">...</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>So, it looks like XML parsing this beast is both slow and higly error prone.
What else could we do? We could try using a more accurate or graceful xml
parser that’s built to deal with html’s malformities, but I’ll leave out story
of how that doesn’t work well in this case either. Instead, we’ll do something
even more silly.</p>

<h2 id="in-rolls-javascript">In rolls javascript</h2>

<p>Obviously someone code path out in the world has to be capable of handling this
html mess. Otherwise it’d never show in a browser. But what’s the shortest path
for doing this? Hacking through either the Firefox source code or the <a href="https://src.chromium.org/viewvc/chrome/">Chromium
source code </a>both sound like longest
path solutions to me. In comes the magic of Javascript.
<a href="https://jquery.com/">jQuery</a> is able to single handedly take an html file,
turn it into a <a href="https://en.wikipedia.org/wiki/Document_Object_Model">Document Object
Model</a> structure, and let
you run queries over it, not only does this work in a few lines of code, it’s
super fast.</p>

<h3 id="a-quick-setup">A quick setup</h3>

<p><em>But</em>, first you have to do a little setup to run all this outside of a
browser. The easiest system I found was <a href="https://nodejs.org/en/">node.js</a>. To
setup, all you have to do is grab a tarball, I used <a href="http://nodejs.org/dist/v0.8.8/node-v0.8.8.tar.gz">this
one</a>, untar it, and added the
binaries to your path:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://nodejs.org/dist/v0.8.7/node-v0.8.7.tar.gz
<span class="nb">tar</span> <span class="nt">-xvzf</span> node-v0.8.7.tar.gz
<span class="nb">export</span> <span class="nv">$PATH</span>:<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/node-v0.8.7-linux-x86/bin/node
<span class="nb">export</span> <span class="nv">$PATH</span>:<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/node-v0.8.7-linux-x86/bin/npm
</code></pre></div></div>

<p>And to get jQuery setup for node.js, it’s as easy as running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>jquery
</code></pre></div></div>

<p>Only hitch is that you have to run this from the root directory where you’ll be
running your processing, but that’s a minor problem.</p>

<h3 id="parsing-power">Parsing Power!</h3>

<p>Now that our javascript runtime environment is setup with the library we need,
it’s time to get into the meat of the code. The approach is pretty simple:</p>

<ol>
  <li>parse a html file using jquery</li>
  <li>Find the nodes with the <code class="language-plaintext highlighter-rouge">bar</code> id nested within a div having a <code class="language-plaintext highlighter-rouge">disciplines</code>
id.</li>
  <li>
    <p>Get the <code class="language-plaintext highlighter-rouge">class</code> and <code class="language-plaintext highlighter-rouge">data-type</code> attributes from the div we got back and
handle one of three cases:</p>

    <ol>
      <li>The <code class="language-plaintext highlighter-rouge">class</code> attritube tells us all we need</li>
      <li><code class="language-plaintext highlighter-rouge">class</code> and <code class="language-plaintext highlighter-rouge">data-type</code> include timing information</li>
      <li>the <code class="language-plaintext highlighter-rouge">data-type</code> attribute tells us all we need.</li>
    </ol>
  </li>
</ol>

<p>So let’s code that up! First, import the js libraries you need.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="c1">/// Import jquery library.</span>
<span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Import file system library.</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Now parse the javascript to get a DOM structure:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Throw any errors found.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
    <span class="c1">// Convert the raw data to text.</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>

    <span class="c1">// More coming shortly!</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>So far so easy, breezy. Now comes the challenging part: grabbing the div’s
holding the timing info we need and checking for the funny ways <a href="www.london2012.com/index-olympic.html">london
2012</a> decided to encode that
information:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre>    <span class="c1">// Navigate the html to find all div elements with the "disciplines" class</span>
    <span class="c1">// and the children of these elements with the "bar" class.  These elements</span>
    <span class="c1">// define the time of each event.</span>
    <span class="kd">var</span> <span class="nx">barElemens</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.disciplines</span><span class="dl">"</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="dl">"</span><span class="s2">.bar</span><span class="dl">"</span><span class="p">)</span>
    <span class="c1">// For each bar element found, extract the start time and end time.  The</span>
    <span class="c1">// start time is the text within the span having a ".bar-time" class and the</span>
    <span class="c1">// end time is the second class label of each element.</span>
    <span class="nx">barElemens</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Convert the index to an element in the array.</span>
        <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">barElemens</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">classAttr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">dataType</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-type</span><span class="dl">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">dataType</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the data-type attribute is empty, then we know that both the</span>
            <span class="c1">// start and end times are stored in the class attribute, albeit in</span>
            <span class="c1">// an utterly horrible and wretched format that uses two different</span>
            <span class="c1">// timezones and two different formats.</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">classAttr</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">dataType</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">_</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the data-type ends with an underscore, we know that the start</span>
            <span class="c1">// time is in the text and the end time is in the class attribute.</span>
            <span class="c1">// So report that.</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">classAttr</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">.bar-time</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Otherwise, the data-type has the full time range for the event,</span>
            <span class="c1">// so just report that, even though it's in a different format.</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataType</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span> <span class="c1">// This ends the original jquery call to parse the html file</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>And that’s it. With jQuery and node.js, I have significantly more comments than
actual code, mostly to describe my new understanding of the api’s and data
based logic processing that no human should have to decifer through code.</p>

<h3 id="actually-getting-the-data">Actually getting the data</h3>

<p>Actually downloading the data requires a few simple tricks that are worth
noting, just in case anyone ever wants to duplicatet this whole shebang.</p>

<p>First, london 2012 doesn’t let you do a normal <code class="language-plaintext highlighter-rouge">wget</code> call, it requires a user
agent. So, every request looks like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>userAgent="Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.3) Gecko/2008092416 Firefox/3.0.3"
wget --user-agent=$userAgent $url
</code></pre></div></div>

<p>Now we just need to figure out the pattern for each sport. For once, london
2012 makes that part easy. Their uer’s use just two key values: the sport you want and the day you want, so here’s a little bit of bash to extract all that (and save everything in an easier to use file name:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sports="judo gymnastics-artistic fencing tennis archery"
julyDays=`seq  25 31 | while read day; do echo $day-july; done`
augDays=`seq 1 12 | while read day; do echo $day-august; done`
userAgent="Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.3) Gecko/2008092416 Firefox/3.0.3"
resultDir=tmpHtmlData

# Define a helper function to return the full url based on the sport and day.
# This is just to make changing the url easier.
function olympicsUrl() {
    echo http://www.london2012.com/$sport/schedule-and-results/day=$day/all-day.html 
}

# Now iterate through every sport.
for sport in $sports; do
    # And every day of the olympics.
    for day in $julyDays $augDays; do
        # And do a simple wget request.  Since each page has the same html file
        # name, the -O bit saves the html output to a file based on the sport
        # and day for easier management.
        wget --user-agent=$userAgent -O $tmpHtmlData/$sport-$day.html `olympicsUrl`
    done
done
</code></pre></div></div>

<p>And voila, you have all the sports you want for each day of the olympics. You
can no easily power through all those files with this dandy bit of code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for sport in $sports; do
    for html in $resultDir/*$sport*.html; do
        node src/main/javascript/ExtractTimes.js $html
    done &gt; olympics.$sport.times.txt
done
</code></pre></div></div>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License"
           style="border-width:0"
           src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    This
    work is licensed under a
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      Creative Commons Attribution 4.0 International License
    </a>.

    <br />

    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with the <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
